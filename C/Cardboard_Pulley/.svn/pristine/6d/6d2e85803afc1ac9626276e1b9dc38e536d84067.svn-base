/*
** main.c for Cardboard_Pulley in /cygdrive/c/Users/Habi/Documents/ETNA/C/Cardboard_Pulley/etape1
**
** Made by HABI Açal
** Login   <habi_a@etna-alternance.net>
**
** Started on  Sat Jan 20 23:33:17 2018 HABI Açal
** Last update Wed Jan 24 18:09:38 2018 HABI Açal
*/
#include <stdlib.h>
#include "struct.h"

int			main()
{
    int			playing;
    char		user_input;
    char		*path;
    t_room		*room;
    t_char		*player;
    t_func_ptr_move	move_to[4];
    t_func_ptr_move	check_move_to[4];

    playing = 1;
    path = "../Maps/Inner_Hell/cargo_dock.map";
    player = malloc(sizeof(*player));
    room = malloc(sizeof(*room));
    if (player == NULL || room == NULL)
        return (-1);
    init_func_ptr(move_to, check_move_to);
    init_room(room, path, 2, 9);
    init_player(player, room);
    create_room(room);
    clear_screen();
    my_putstr("Find the exit!\n");
    my_print_room(room, player);
    while (playing)
    {
        user_input = readline();
        if (user_input == 'W')
        {
            clear_screen();
            if (check_move(player, room, check_move_to, E_FORWARD))
                move(player, room, move_to, E_FORWARD);
            my_print_room(room, player);
        }
        else if (user_input == 'S')
        {
            clear_screen();
            if (check_move(player, room, check_move_to, E_BACKWARD))
                move(player, room, move_to, E_BACKWARD);
            my_print_room(room, player);
        }
        else if (user_input == 'A')
        {
            clear_screen();
            if (check_move(player, room, check_move_to, E_LEFT))
                move(player, room, move_to, E_LEFT);
            my_print_room(room, player);
        }
        else if (user_input == 'D')
        {
            clear_screen();
            if (check_move(player, room, check_move_to, E_RIGHT))
                move(player, room, move_to, E_RIGHT);
            my_print_room(room, player);
        }
        else if (user_input == 'Q')
            playing = 0;
        else if (user_input != '\0')
        {
            clear_screen();
            my_putstr("Mauvaise touche\n");
            my_print_room(room, player);
        }
        if (check_win(player))
        {
            my_putstr("To be continued...\n");
            break;
        }
    }
    free(player);
    free(room);
    return (0);
}
